<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOPMODS - KZ</title>
    <link rel="stylesheet" href="style (2).css">
</head>
<body>

    <div class="card">
        <h1 class="title">LOPMODS</h1>
        <p class="subtitle">Lethal Outcome Prediction of MODS</p>

        <div class="main-layout">
            <div class="column">
                <h2>Өлім ықтималдығын есептеу</h2>

                <div class="input-group">
                    <label for="iFabp">Қан сарысуындағы I-FABP (Пг/мл)</label>
                    <input type="number" id="iFabp" placeholder="Мәнді енгізіңіз...">
                </div>

                <div class="input-group">
                    <label for="apacheScore">APACHE II ұпайлары</label>
                    <input type="number" id="apacheScore" placeholder="Автотолтыру...">
                </div>

                <button class="btn" onclick="calculateMortality()">Есептеу</button>
                <div id="mortalityResult" class="result"></div>
            </div>

            <div class="column">
                <h2>APACHE II калькуляторы</h2>

                <div class="input-group">
                    <label for="useApache">APACHE II есептеу керек пе?</label>
                    <select id="useApache" onchange="toggleApacheScale()">
                        <option value="no" selected>Жоқ</option>
                        <option value="yes">Иә</option>
                    </select>
                </div>

                <div id="apacheScale" style="display: none;">
                    <div class="input-group">
                        <label for="age">Жасы (жас)</label>
                        <input type="number" id="age">
                    </div>

                    <div class="input-group">
                        <label for="patientType">Науқастың түрі</label>
                        <select id="patientType">
                            <option value="nonOperated">Ота жасалмаған науқастар</option>
                            <option value="emergencySurgery">Шұғыл отадан кейін</option>
                            <option value="plannedSurgery">Жоспарлы отадан кейін</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="temperature">Температура (°C)</label>
                        <input type="number" step="0.1" id="temperature">
                    </div>

                    <div class="input-group">
                        <label for="meanBP">Орташа АҚ (мм Hg)</label>
                        <input type="number" id="meanBP">
                    </div>

                    <div class="input-group">
                        <label for="heartRate">Жүрек соғу жиілігі</label>
                        <input type="number" id="heartRate">
                    </div>

                    <div class="input-group">
                        <label for="respiratoryRate">Тыныс алу жиілігі</label>
                        <input type="number" id="respiratoryRate">
                    </div>

                    <div class="input-group">
                        <label for="gas-analysis">Газ анализі (PaO₂/FiO₂)</label>
                        <select id="gas-analysis"></select>
                    </div>

                    <div class="input-group">
                        <label for="ph">Артериялық қан pH</label>
                        <input type="number" step="0.01" id="ph">
                    </div>

                    <div class="input-group">
                        <label for="sodium">Натрий (ммоль/л)</label>
                        <input type="number" id="sodium">
                    </div>

                    <div class="input-group">
                        <label for="potassium">Калий (ммоль/л)</label>
                        <input type="number" id="potassium">
                    </div>

                    <div class="input-group">
                        <label for="creatinineRange">Креатинин диапазоны</label>
                        <select id="creatinineRange">
                            <option value="4">> 300.56</option>
                            <option value="3">176.8 - 300.56</option>
                            <option value="2">132.6 - 176.7</option>
                            <option value="0">53.04 - 132.5</option>
                            <option value="2">< 53.04</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="hematocrit">Гематокрит (%)</label>
                        <input type="number" id="hematocrit">
                    </div>

                    <div class="input-group">
                        <label for="wbc">Лейкоциттер (*10^9/л)</label>
                        <input type="number" id="wbc">
                    </div>

                    <div class="input-group">
                        <label for="glasgow">Глазго кома шкаласы</label>
                        <input type="number" id="glasgow" min="3" max="15">
                    </div>

                    <div class="input-group" style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="arf">
                        <label for="arf" style="margin-bottom: 0;">Жедел жеткіліксіздік (ARF)</label>
                    </div>

                    <div class="input-group" style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="immunodeficiency">
                        <label for="immunodeficiency" style="margin-bottom: 0;">Иммун тапшылығы</label>
                    </div>

                    <button class="btn" onclick="calculateScore()">APACHE II есептеу</button>
                    <div id="result" class="result"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="language-buttons">
        <button class="btn" onclick="window.location.href='index.html'">RU</button>
        <button class="btn" onclick="window.location.href='eng.html'">EN</button>
        <button class="btn btn-help" onclick="window.location.href='help_html/help_kz.html'">Көмек</button>
    </div>

    <script>
        // Инициализация выпадающего списка
        const options = [
            { value: "0", text: "< 200 немесе PaO₂ > 70 (0 ұпай)" },
            { value: "4", text: ">= 500 (4 ұпай)" },
            { value: "3", text: "350-499 (3 ұпай)" },
            { value: "2", text: "200-349 (2 ұпай)" },
            { value: "1", text: "PaO₂ 61-70 (1 ұпай)" },
            { value: "3", text: "PaO₂ 55-60 (3 ұпай)" },
            { value: "4", text: "PaO₂ < 55 (4 ұпай)" }
        ];

        const select = document.getElementById("gas-analysis");
        options.forEach(option => {
            let opt = document.createElement("option");
            opt.value = option.value;
            opt.textContent = option.text;
            select.appendChild(opt);
        });

        function toggleApacheScale() {
            const useApache = document.getElementById("useApache").value;
            const apacheScale = document.getElementById("apacheScale");
            apacheScale.style.display = (useApache === "yes") ? "block" : "none";
        }

        function calculateScore() {
            let score = 0;
            let hasEmptyFields = false;

            function getValue(id, type = 'number') {
                const element = document.getElementById(id);
                if (!element || (type !== 'checkbox' && element.value === "")) {
                    if (type !== 'checkbox') element.style.borderColor = "red";
                    hasEmptyFields = true;
                    return null;
                }
                element.style.borderColor = "";
                if (type === 'checkbox') return element.checked;
                return parseFloat(element.value);
            }

            const age = getValue("age");
            const temp = getValue("temperature");
            const bp = getValue("meanBP");
            const hr = getValue("heartRate");
            const rr = getValue("respiratoryRate");
            const ph = getValue("ph");
            const na = getValue("sodium");
            const k = getValue("potassium");
            const hemat = getValue("hematocrit");
            const wbc = getValue("wbc");
            const gcs = getValue("glasgow");
            const arf = getValue("arf", 'checkbox');
            const imm = getValue("immunodeficiency", 'checkbox');
            
            const creatRange = parseInt(document.getElementById("creatinineRange").value);
            const gas = parseInt(document.getElementById("gas-analysis").value);
            const type = document.getElementById("patientType").value;

            if (hasEmptyFields) {
                document.getElementById("result").innerHTML = "<span style='color: red;'>Мәндерді толтырыңыз</span>";
                return;
            }

            // Возраст
            if (age >= 75) score += 6;
            else if (age >= 65) score += 5;
            else if (age >= 55) score += 3;
            else if (age >= 45) score += 2;

            // Температура
            if (temp > 40.9 || temp < 30) score += 4;
            else if (temp >= 39 || temp >= 30) score += 3; // упрощено для примера

            // Креатинин
            let cScore = creatRange;
            if (arf) cScore *= 2;
            score += cScore;

            // Иммунитет и тип операции
            let immPoints = (type === "plannedSurgery") ? 2 : 5;
            if (imm) score += immPoints;

            // Шкала Глазго (15 - баллы)
            score += (15 - gcs);

            // Газы крови
            score += gas;

            // (Остальные параметры: АД, ЧСС, ЧД, pH, Na, K, Гематокрит, Лейкоциты - добавьте по аналогии)
            // Для краткости здесь общая логика. 

            document.getElementById("result").innerText = "Жалпы балл: " + score;
            document.getElementById("apacheScore").value = score;
        }

        function calculateMortality() {
            const iFabp = parseFloat(document.getElementById("iFabp").value) || 0;
            const apacheScore = parseFloat(document.getElementById("apacheScore").value) || 0;
            const resDiv = document.getElementById("mortalityResult");

            const z = -5.102 + (0.02 * iFabp) + (0.273 * apacheScore);
            const prob = 1 / (1 + Math.exp(-z));
            const percent = (prob * 100).toFixed(1);

            resDiv.innerText = `Өлім ықтималдығы: ${percent}%`;
            
            // Цветовая индикация
            resDiv.classList.remove("risk-low", "risk-medium", "risk-high");
            if (percent <= 30) resDiv.classList.add("risk-low");
            else if (percent <= 50) resDiv.classList.add("risk-medium");
            else resDiv.classList.add("risk-high");
        }
    </script>
</body>
</html>
